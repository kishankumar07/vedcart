<%- include('./layouts/header.ejs')%>

<!-- category filtration is present at 264 -->
<style>
  .product-media {
     position: relative;
     overflow: hidden;
 }
 
 .product-link {
     display: block;
 }
 
 .hover-img {
     position: absolute;
     top: 0;
     left: 0;
     opacity: 0;
     transition: opacity 0.3s ease;
 }
 
 .product-link:hover .hover-img {
     opacity: 1;
 }
 
 
 </style>


  <body>
    <div class="page-wrapper">
      <main class="main">
        <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
          <div class="container">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="#">Shop</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                    <% if (categoryName === 'All') { %>
                        <%= categoryName %>
                    <% } else { %>
                        <%= categoryName %>
                    <% } %>
                </li>
            </ol>
        </div>
        
          <!-- End .container -->
        </nav>
        <!-- End .breadcrumb-nav -->

        <div class="page-content">
          <div class="container">
            <div class="row">
              <div class="col-lg-9 col-xl-4-5col">
               
                <!-- End .owl-carousel -->

                <div class="mb-3"></div>
                <!-- End .mb-3 -->

              

                <div class="mb-3 mb-lg-5"></div>
                <!-- End .mb-3 mb-lg-5 -->

                <div class="mb-2"></div>
                <!-- End .mb-2 -->

                <div class="mb-4"></div>
                <!-- End .mb-4 -->
                <div class="toolbox">
                  <div class="toolbox-left" style="display: grid; grid-template-columns: auto;">
                    <div class="search-box" style="width: 200px; height: 31px;">



                      <input
                         type="text"
                      placeholder="Search product"
                      class="form-control"
                      id="searchInput"
                      oninput="searchUsers()"
                    />
                  </div>
                  
                    <div class="toolbox-info">10 products found</div>
                    <!-- End .toolbox-info -->
                </div>
                
                
                
                
                
                  <!-- End .toolbox-left -->
                
                  <div class="toolbox-right">
                    <div class="toolbox-sort">
                      <label for="sortby">Sort by:</label>
                      <div class="select-custom">
                        <select name="sortby" id="sortby" class="form-control">
                          <option value="popularity" selected="selected">
                            Most Popular
                          </option>
                          <option value="rating">Most Rated</option>
                          <option value="date">Date</option>
                        </select>
                      </div>
                    </div>
                    <!-- End .toolbox-sort -->
                  </div>
                  <!-- End .toolbox-right -->
                </div>
                
                <!-- End .toolbox -->
             
                <div class="products mb-3 tablet">
                  <div class="row">

                    <% if(product.length > 0) {%>
                    <% for(let i=0;i< product.length;i++) { %>

                    <div class="col-6 col-md-4 col-xl-3">
                      <div class="product">
                        <figure class="product-media">
                        
                          <a href="/productPage?id=<%= product[i]._id %>" class="product-link">
                            <img class="default-img product-image" src="/adminAssets/imgs/category/<%= product[i].images[0] %>" alt="Product image">
                            <img class="hover-img product-image" src="/adminAssets/imgs/category/<%= product[i].images[1] %>" alt="Product image">
                        </a>
                          
                          <div class="product-action-vertical">



                            <% if (user) { %>
                              <a
                                  href="#"
                                  onclick="wishList(event,'<%= product[i]._id %>','<%= user %>')"
                                  class="btn-product-icon btn-wishlist btn-expandable"
                              >
                                  <span>add to wishlist</span>
                              </a>
                          <% } else { %>
                              <a
                                  href="#"
                                  onclick="wishList('<%= product[i]._id %>','')"
                                  class="btn-product-icon btn-wishlist btn-expandable"
                              >
                                  <span>add to wishlist</span>
                              </a>
                          <% } %>
                          
                          




                            <a
                              href="#"
                              class="btn-product-icon btn-compare"
                              title="Compare"
                              ><span>Compare</span></a
                            >
                            <a
                              href="/userAssets/home/popup/quickView.html"
                              class="btn-product-icon btn-quickview"
                              title="Quick view"
                              ><span>Quick view</span></a
                            >
                          </div>
                          <!-- End .product-action-vertical -->

                          <div class="product-action">
                            <a
                              href="#"
                              class="btn-product btn-cart"
                              title="Add to cart"
                              ><span>add to cart</span></a
                            >
                          </div>
                          <!-- End .product-action -->
                        </figure>
                        <!-- End .product-media -->

                        <div class="product-body">
                          <div class="product-cat">
                            <a href="#"><%= product[i].category.name %></a>
                          </div>
                          <!-- End .product-cat -->
                          <h3 class="product-title">
                            <a href="/productPage?id=<%=  product[i]._id%>"
                              ><%= product[i].name %></a
                            >
                          </h3>
                          <!-- End .product-title -->
                          <div class="product-price">Rs.<%= product[i].price %></div>
                          <!-- End .product-price -->





                          <!-- stock part -->
                          <% if (product[i].quantity === 0) { %>
                            <h5 style="color: red;">OUT OF STOCK!</h5>
                            <% } else if(product[i].quantity ===1) { %>
                                <span style="color: #4eb44e;">Only <%=product[i].quantity%> left!</span>
                                <% } else if(product[i].quantity <=15) { %>
                                    <span style="color: #40a240;"> Hurry Only <%=product[i].quantity%> items left!</span>
                                    <% } %>

                                  <!-- stock part ends -->

                          <div class="ratings-container">
                            <div class="ratings">
                              <div class="ratings-val" style="width: 60%"></div>
                              <!-- End .ratings-val -->
                            </div>
                            <!-- End .ratings -->
                            <span class="ratings-text">( 6 Reviews )</span>
                          </div>
                          <!-- End .rating-container -->
                        </div>
                        <!-- End .product-body -->
                      </div>
                      <!-- End .product -->
                    </div>
                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->

                   <% } %>

                   <% } else { %>
                    <tr>
                      <td colspan="2">Product not found</td>
                    </tr>
                    <% } %>


                  </div>
                  <!-- End .row -->
                </div>
                <!-- End .products -->

                <nav aria-label="Page navigation">
                  <ul class="pagination">
                    <li class="page-item disabled">
                      <a
                        class="page-link page-link-prev"
                        href="#"
                        aria-label="Previous"
                        tabindex="-1"
                        aria-disabled="true"
                      >
                        <span aria-hidden="true"
                          ><i class="icon-long-arrow-left"></i></span
                        >Prev
                      </a>
                    </li>
                    <li class="page-item active" aria-current="page">
                      <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item">
                      <a class="page-link" href="#">2</a>
                    </li>
                    <li class="page-item-total">of 2</li>
                    <li class="page-item">
                      <a
                        class="page-link page-link-next"
                        href="#"
                        aria-label="Next"
                      >
                        Next
                        <span aria-hidden="true"
                          ><i class="icon-long-arrow-right"></i
                        ></span>
                      </a>
                    </li>
                  </ul>
                </nav>
              </div>
              <!-- End .col-lg-9 -->

              <aside class="col-lg-3 col-xl-5col order-lg-first">
                <div class="sidebar sidebar-shop">
                 
                  <!-- End .widget -->
              

                  <div class="widget">
                    <h3 class="widget-title">Category</h3>
                    <!-- End .widget-title -->
                    <% if(category.length > 0) { %>
                        <div class="widget-body">
                            <div class="filter-items">
                                <div class="filter-item">
                                    <div class="custom-control custom-radio">
                                        <input
                                            type="radio"
                                            class="custom-control-input"
                                            id="category-all"
                                            name="category"
                                            onclick="selectCategory('all')"
                                            value="all"
                                            <% if (!selectedCategoryId) { %>
                                                checked
                                            <% } %> <!-- Check if category is selected -->
                                        
                                        <label class="custom-control-label" for="category-all">All</label>
                                    </div>
                                    <!-- End .custom-checkbox -->
                                </div>
                                <!-- End .filter-item -->
                                <% category.forEach((cat, index) => { %>
                                    <div class="filter-item">
                                        <div class="custom-control custom-radio">
                                            <input
                                                type="radio"
                                                class="custom-control-input"
                                                id="category-<%= index %>"
                                                name="category"
                                                onclick="selectCategory('<%= cat._id %>')"
                                                value="<%= cat._id %>"
                                                <% if (cat._id === selectedCategoryId) { %>
                                                    checked
                                                <% } %> <!-- Check if category is selected -->
                                            
                                            <label class="custom-control-label" for="category-<%= index %>"><%= cat.name %></label>
                                        </div>
                                        <!-- End .custom-checkbox -->
                                    </div>
                                    <!-- End .filter-item -->
                                <% }); %>
                            </div>
                            <!-- End .filter-items -->
                        </div>
                        <!-- End .widget-body -->
                    <% } else { %>
                        <tr>
                            <td colspan="2">category not found</td>
                        </tr>
                    <% } %>
                </div>
                
                  
              
                 
                  

                  </div>
                  <!-- End .widget -->
                  

                  <div class="widget">
                    <h3 class="widget-title">Price</h3>
                    <!-- End .widget-title -->

                    <div class="widget-body">
                      <div class="filter-items">
                        <div class="filter-item">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="price-1"
                              name="filter-price"
                            />
                            <label class="custom-control-label" for="price-1"
                              >Under $25</label
                            >
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="price-2"
                              name="filter-price"
                            />
                            <label class="custom-control-label" for="price-2"
                              >$25 to $50</label
                            >
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="price-3"
                              name="filter-price"
                            />
                            <label class="custom-control-label" for="price-3"
                              >$50 to $100</label
                            >
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="price-4"
                              name="filter-price"
                            />
                            <label class="custom-control-label" for="price-4"
                              >$100 to $200</label
                            >
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="price-5"
                              name="filter-price"
                            />
                            <label class="custom-control-label" for="price-5"
                              >$200 & Above</label
                            >
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->
                      </div>
                      <!-- End .filter-items -->
                    </div>
                    <!-- End .widget-body -->
                  </div>
                  <!-- End .widget -->

                  <div class="widget">
                    <h3 class="widget-title">Customer Rating</h3>
                    <!-- End .widget-title -->

                    <div class="widget-body">
                      <div class="filter-items">
                        <div class="filter-item">
                          <div class="custom-control custom-checkbox">
                            <input
                              type="checkbox"
                              class="custom-control-input"
                              id="cus-rating-1"
                            />
                            <label
                              class="custom-control-label"
                              for="cus-rating-1"
                            >
                              <span class="ratings-container">
                                <span class="ratings">
                                  <span
                                    class="ratings-val"
                                    style="width: 100%"
                                  ></span
                                  ><!-- End .ratings-val --> </span
                                ><!-- End .ratings -->
                                <span class="ratings-text">( 24 )</span> </span
                              ><!-- End .rating-container -->
                            </label>
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-checkbox">
                            <input
                              type="checkbox"
                              class="custom-control-input"
                              id="cus-rating-2"
                            />
                            <label
                              class="custom-control-label"
                              for="cus-rating-2"
                            >
                              <span class="ratings-container">
                                <span class="ratings">
                                  <span
                                    class="ratings-val"
                                    style="width: 80%"
                                  ></span
                                  ><!-- End .ratings-val --> </span
                                ><!-- End .ratings -->
                                <span class="ratings-text">( 8 )</span> </span
                              ><!-- End .rating-container -->
                            </label>
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-checkbox">
                            <input
                              type="checkbox"
                              class="custom-control-input"
                              id="cus-rating-3"
                            />
                            <label
                              class="custom-control-label"
                              for="cus-rating-3"
                            >
                              <span class="ratings-container">
                                <span class="ratings">
                                  <span
                                    class="ratings-val"
                                    style="width: 60%"
                                  ></span
                                  ><!-- End .ratings-val --> </span
                                ><!-- End .ratings -->
                                <span class="ratings-text">( 5 )</span> </span
                              ><!-- End .rating-container -->
                            </label>
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-checkbox">
                            <input
                              type="checkbox"
                              class="custom-control-input"
                              id="cus-rating-4"
                            />
                            <label
                              class="custom-control-label"
                              for="cus-rating-4"
                            >
                              <span class="ratings-container">
                                <span class="ratings">
                                  <span
                                    class="ratings-val"
                                    style="width: 40%"
                                  ></span
                                  ><!-- End .ratings-val --> </span
                                ><!-- End .ratings -->
                                <span class="ratings-text">( 1 )</span> </span
                              ><!-- End .rating-container -->
                            </label>
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->

                        <div class="filter-item">
                          <div class="custom-control custom-checkbox">
                            <input
                              type="checkbox"
                              class="custom-control-input"
                              id="cus-rating-5"
                            />
                            <label
                              class="custom-control-label"
                              for="cus-rating-5"
                            >
                              <span class="ratings-container">
                                <span class="ratings">
                                  <span
                                    class="ratings-val"
                                    style="width: 20%"
                                  ></span
                                  ><!-- End .ratings-val --> </span
                                ><!-- End .ratings -->
                                <span class="ratings-text">( 3 )</span> </span
                              ><!-- End .rating-container -->
                            </label>
                          </div>
                          <!-- End .custom-checkbox -->
                        </div>
                        <!-- End .filter-item -->
                      </div>
                      <!-- End .filter-items -->
                    </div>
                    <!-- End .widget-body -->
                  </div>
                  <!-- End .widget -->

                 

                
                </div>
                <!-- End .sidebar sidebar-shop -->
              </aside>
              <!-- End .col-lg-3 -->
            </div>
            <!-- End .row -->
          </div>
          <!-- End .container -->
        </div>
        <!-- End .page-content -->



        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

 <script>

          //category selection based on filtarion

         
    document.addEventListener("DOMContentLoaded", function() {
        const selectedCategoryId = '<%= selectedCategoryId %>'; // Get selected category ID from EJS
        const radioButton = document.querySelector(`input[value="${selectedCategoryId}"]`);
        if (!selectedCategoryId) {
            const allRadioButton = document.querySelector('input[name="category"][value="all"]');
            if (allRadioButton) {
                allRadioButton.checked = true;
            }
        } else if (radioButton) {
            radioButton.checked = true;
        }
    });

    function selectCategory(categoryId) {
        if (categoryId === 'all') {
            window.location.href = '/shop'; // Redirect to shop page without specifying a category
        } else {
            window.location.href = `/shop?category=${categoryId}`;
        }
    }




          //search query at input search 

    

    function searchUsers() {
    // Get the value of the search input
    const searchQuery = document
      .getElementById("searchInput")
      .value.toLowerCase();

    // Get all card elements with class 'tablet'
    const cards = document.querySelectorAll(".tablet");

    // Loop through each card and filter based on the search query
    cards.forEach((card) => {
      // Extract the category name from the card
      const categoryName = card
        .querySelector(".product-title")
        .textContent.toLowerCase();

      // Check if the category name contains the search query
      if (categoryName.includes(searchQuery)) {
        // If the category name contains the search query, display the card
        card.style.display = "block"; // Assuming it's initially set to 'none'
      } else {
        // If not, hide the card
        card.style.display = "none";
      }
    });
  }

//===========wishlisting a product==============================

  function wishList(event,productId,userId){
    event.preventDefault();
  // console.log('this is the user id at wishlist addition :',userId);
  // console.log('this is the product id at wishlist add : ',productId);

  //case if the usr is not logged in
  if(!userId){
    Swal.fire({
        title: 'Login to Purchase',
        text: 'To make a purchase, please log in.',
        icon: 'info',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Login'
    }).then((result) => {
        if (result.isConfirmed) {
            
            window.location.href = '/signin';
        }
    });
  }

else{
  //if the user is already logged-----------
  fetch(`/productaddtowishlist?productId=${productId}&userId=${userId}`, {
            method: 'POST', // Use POST or PATCH for updating data
            headers: {
            'Content-Type': 'application/json',
             },
        
    }).then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
           
            return response.json();
        })
        .then(data => {
            
            if(data.success===true)
            {
              
              Swal.fire({
          title: "Added to Wishlist",
          // text: "OTP Successfully sent to <%= locals.email%>",
          icon: "success",
          timer: 2500,
          showConfirmButton: false, // This removes the button
        });
            
            }
        
            else{
              Swal.fire({
          title: "Already added to wishlist",
          // text: "OTP Successfully sent to <%= locals.email%>",
          icon: "warning",
          timer: 2500,
          showConfirmButton: false, // This removes the button
        });

              
            }})
                   
           
        
        
        .catch(error => {
            console.error('Error:', error);
        });

}

}


  </script>


<%- include('./layouts/footer.ejs') %>
