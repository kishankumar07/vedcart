<%- include('./layouts/header') %>

<style>
.toolbox-left {
    display: flex;
    align-items: center;
}
.toolbox-left input[type="text"] {
    flex: 1; /* Take up remaining space */
    margin-right: 10px; /* Adjust the margin between the input and button */
}


</style>








  <body>
    <div class="page-wrapper">
      <main class="main">
        <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
          <div class="container">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="index.html">Home</a></li>
              <li class="breadcrumb-item"><a href="#">Shop</a></li>
              <li class="breadcrumb-item active" aria-current="page">

                <% if (query.category) { %>
                    <%= category.find(cat => cat._id.toString() === query.category).name %>
                <% } else { %>
                    All
                <% } %>

            </li>
            </ol>
          </div>
          <!-- End .container -->
        </nav>
        <!-- End .breadcrumb-nav -->

        <div class="page-content">
          <div class="container">
            <div class="row">
              <div class="col-lg-9 col-xl-4-5col">
                <div
                  class="category-banners-slider owl-carousel owl-simple owl-nav-inside"
                  data-toggle="owl"
                  data-owl-options='{
                                    "nav": false,
                                    "responsive": {
                                        "768": {
                                            "nav": true
                                        }
                                    }
                                }'
                > <div class="banner banner-poster">
                                    
                  <a href="#">
                      <img src="/userAssets/home/assets/images/demos/demo-13/banners/banner.webp" alt="Banner">
                  </a>

                  <div hidden class="banner-content banner-content-right">
                      <h3 class="banner-subtitle"><a href="#">Amazing Value</a></h3><!-- End .banner-subtitle -->
                      <h2 class="banner-title"><a href="#">High Performance 4K TVs</a></h2><!-- End .banner-title -->
                      <a href="#" class="banner-link">Shop Now <i class="icon-long-arrow-right"></i></a>
                  </div><!-- End .banner-content -->
              </div><!-- End .banner -->
                 
                  <!-- End .banner -->

                  
                  <!-- End .banner -->
                </div>
                <!-- End .owl-carousel -->

                <div class="mb-3"></div>
                <!-- End .mb-3 -->

              

                <div class="mb-3 mb-lg-5"></div>
                <!-- End .mb-3 mb-lg-5 -->

                <div class="mb-2"></div>
                <!-- End .mb-2 -->

                <div class="mb-4"></div>
                <!-- End .mb-4 -->

                <div class="toolbox">
                  <div class="toolbox-left">
                    <input type="text" class="form-control" id="searchInput" placeholder="Search..." aria-label="Search" />
                    <a href="#" onclick="searchProducts()" class="btn btn-link btn-link-dark"><span>Search</span><i class="icon-long-arrow-right"></i></a>  
                    <!-- End .toolbox-info -->
                  </div>
                  <!-- End .toolbox-left -->

                  <div class="toolbox-right">
                    <div class="toolbox-sort">
                        <label for="sortby">Sort by:</label>
                        <div class="select-custom">
                            <select name="sortby" id="sortby" class="form-control" onchange="sortProducts(this)">
                              <option value="select" <% if (!query.sort) { %>selected<% } %>>Select</option>
                              <option value="nameAsc" <% if (query.sort === 'nameAsc') { %>selected<% } %>>A-Z</option>
                                <option value="nameDesc" <% if (query.sort === 'nameDesc') { %>selected<% } %>>Z-A</option>
                                <option value="date" <% if (query.sort === 'date') { %>selected<% } %>>Newly Launched</option>
                            </select>
                        </div>
                    </div>
                    <!-- End .toolbox-sort -->
                </div>
                <!-- End .toolbox-right -->
                
                  <!-- End .toolbox-right -->
                </div>
                <!-- End .toolbox -->


                

                   

                <div class="products mb-3">
                  <div class="row">

                    <% product.forEach(product=>{ %>
                    <div class="col-6 col-md-4 col-xl-3">
                       
                      <div class="product">
                        <figure class="product-media">
                          <span hidden class="product-label label-new">New</span>
                          <a href="product.html">
                            <img
                              src="/adminAssets/imgs/category/<%= product.images[0] %>"
                              alt="Product image"
                              class="product-image"
                            />
                          </a>

                          <div class="product-action-vertical">
                            <a
                              href="#"
                              class="btn-product-icon btn-wishlist btn-expandable"
                              ><span>add to wishlist</span></a
                            >
                            <a
                              href="#"
                              class="btn-product-icon btn-compare"
                              title="Compare"
                              ><span>Compare</span></a
                            >
                            <a
                              href="popup/quickView.html"
                              class="btn-product-icon btn-quickview"
                              title="Quick view"
                              ><span>Quick view</span></a
                            >
                          </div>
                          <!-- End .product-action-vertical -->

                          <div class="product-action">
                            <a
                              href="#"
                              class="btn-product btn-cart"
                              title="Add to cart"
                              ><span>add to cart</span></a
                            >
                          </div>
                          <!-- End .product-action -->
                        </figure>
                        <!-- End .product-media -->

                        <div class="product-body">
                          <div class="product-cat">
                            <a href="#"><%= product.category.name %></a>
                          </div>
                          <!-- End .product-cat -->
                          <h3 class="product-title">
                            <a href="product.html"><%= product.name %></a>
                          </h3>
                          <!-- End .product-title -->
                          <div class="product-price">
                            <% if (product.offer || product.category.offer) { %>
                                <div class="row">


                                    <br>
                                    <span class="original-price  " style="margin-left: 10px;text-decoration: line-through;">₹
                                        <%= product.price %>
                                    </span>
                                   
                                    <span class="offer-price" style="color: red;font-size:16px ;">
                                       (<%= product.offer ? product.offer.discount :
                                            product.category.offer.discount %> % Off)
                                    </span> 


                                </div>
                                <span class="w-100" style="color: rgb(0, 170, 0);font-size: 20px;">₹<%= product.offerprice %>
                                        </span>

                                <% } else { %>
                                  <span class="original-price  " style="margin-left: 10px;">₹
                                    <%= product.price %>
                                </span>
                                        <% } %>


                          </div>
                          <!-- End .product-price -->
                          <div hidden class="ratings-container">
                            <div class="ratings">
                              <div class="ratings-val" style="width: 80%"></div>
                              <!-- End .ratings-val -->
                            </div>
                            <!-- End .ratings -->
                            <span class="ratings-text">( 12 Reviews )</span>
                          </div>
                          <!-- End .rating-container -->
                        </div>
                        <!-- End .product-body -->
                      </div>
                     
                      <!-- End .product -->
                    </div>


                    <%  }) %>
                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->

                  
                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->

                     
                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->

                   
                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->

                  
                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->

                  
                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->

                    <!-- End .col-sm-6 col-md-4 col-xl-3 -->
                  </div>
                  <!-- End .row -->
                </div>
                <!-- End .products -->
                
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        <% if (pagination.currentPage > 1) { %>
                        <li class="page-item">
                            <a class="page-link" href="?page=<%= pagination.currentPage - 1 %>" aria-label="Previous">
                                <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Prev
                              </a>
                        </li>
                      <% } %>
                      <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                        <li class="page-item <%= i === pagination.currentPage ? 'active' : '' %>">
                            <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                          </li>
                      <% } %>
                      <% if (pagination.currentPage < pagination.totalPages) { %>
                        <li class="page-item">
                          <a class="page-link" href="?page=<%= pagination.currentPage + 1 %>"
                            aria-label="Next">
                            Next<span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
                          </a>
                        </li>
                      <% } %>
                    </ul>
                  </nav>
                  
              </div>
              <!-- End .col-lg-9 -->

              <aside class="col-lg-3 col-xl-5col order-lg-first">
                <div class="sidebar sidebar-shop">
                  <div class="widget widget-categories">
                    <h3 class="widget-title">Category</h3>
                    <!-- End .widget-title -->
                    <div class="widget-body">
                      <div class="filter-items">
                        <div class="filter-item">

                            <% category.forEach((category,index)=>{ %>
                               
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="category-<%= index + 1 %>"
                              name="filter-category"
                              onclick="filterByCategory('<%= category._id.toString() %>')"   <% if (query.category === category._id.toString()) { %>checked<% } %>
                              
                            />
                            <label class="custom-control-label" for="category-<%= index + 1 %>"><%= category.name %></label>
                          </div>

                          <% }) %>

                          <!-- End .custom-checkbox -->
                         
                        </div>
                        <!-- End .filter-item -->

                       
                        <!-- End .filter-item -->

                       
                        <!-- End .filter-item -->
                      </div>
                      <!-- End .filter-items -->
                    </div>
                    
                    <!-- End .widget-body -->
                  </div>
                  <!-- End .widget -->

                  
                  <!-- End .widget -->

                  <div class="widget">
                    <h3 class="widget-title">Price</h3>
                    <!-- End .widget-title -->

                    <div class="widget-body">
                      <div class="filter-items">
                        <div class="filter-item">
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="price-low-to-high"
                              name="filter-price"
                              onclick="filterByPrice('low-to-high')"
                              <% if (query.price === 'low-to-high') { %>checked<% } %>
                            />
                            <label class="custom-control-label" for="price-low-to-high"
                            > low to high</label
                            >
                          </div>
                          <!-- End .custom-checkbox -->
                          <div class="custom-control custom-radio">
                            <input
                              type="radio"
                              class="custom-control-input"
                              id="price-high-to-low"
                              name="filter-price"
                              onclick="filterByPrice('high-to-low')"
                              <% if (query.price === 'high-to-low') { %>checked<% } %>
                            />
                            <label class="custom-control-label" for="price-high-to-low"
                            > High to low</label
                            >
                          </div>
                        </div>
                        <!-- End .filter-item -->

                       
                        <!-- End .filter-item -->

                       
                        <!-- End .filter-item -->
                      </div>
                      <!-- End .filter-items -->
                    </div>
                    <!-- End .widget-body -->
                  </div>
                  <!-- End .widget -->

                 
                  <!-- End .widget -->

                
                </div>
                <!-- End .sidebar sidebar-shop -->
              </aside>
              <!-- End .col-lg-3 -->
            </div>
            <!-- End .row -->
          </div>
          <!-- End .container -->
        </div>
        <!-- End .page-content -->

        <div class="cta cta-horizontal cta-horizontal-box bg-primary">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-lg-5">
                <h3 class="cta-title text-white">Join Our Newsletter</h3>
                <!-- End .cta-title -->
                <p class="cta-desc text-white">
                  Subcribe to get information about products and coupons
                </p>
                <!-- End .cta-desc -->
              </div>
              <!-- End .col-lg-5 -->

              <div class="col-lg-7">
                <form action="#">
                  <div class="input-group">
                    <input
                      type="email"
                      class="form-control form-control-white"
                      placeholder="Enter your Email Address"
                      aria-label="Email Adress"
                      required
                    />
                    <div class="input-group-append">
                      <button class="btn btn-outline-white-2" type="submit">
                        <span>Subscribe</span
                        ><i class="icon-long-arrow-right"></i>
                      </button>
                    </div>
                    <!-- .End .input-group-append -->
                  </div>
                  <!-- .End .input-group -->
                </form>
              </div>
              <!-- End .col-lg-7 -->
            </div>
            <!-- End .row -->
          </div>
          <!-- End .container -->
        </div>
        <!-- End .cta -->
      </main>
      <!-- End .main -->

      <script>
        // Function to handle sorting products
        // Function to handle sorting products
function sortProducts(input) {
  const sortValue = input.value;
  const searchParams = new URLSearchParams(window.location.search);
  searchParams.set('sort', sortValue);
  window.location.href = `/shopNew?${searchParams.toString()}`;
}

// Function to handle selecting a category for filtering
function filterByCategory(categoryId) {
  const searchParams = new URLSearchParams(window.location.search);
  searchParams.set('category', categoryId);
  // Remove other filtering options when changing the category

  window.location.href = `/shopNew?${searchParams.toString()}`;
}

// Function to handle filtering products by price range
function filterByPrice(priceRange) {
  const searchParams = new URLSearchParams(window.location.search);
  searchParams.set('price', priceRange);
  // Remove other filtering options when changing the price range
 
  window.location.href = `/shopNew?${searchParams.toString()}`;
}

// Function to handle searching for products
function searchProducts() {
  const searchInput = document.getElementById('searchInput').value;
  const searchParams = new URLSearchParams(window.location.search);
  searchParams.set('search', searchInput);
  // Remove other filtering options when performing a search

  window.location.href = `/shopNew?${searchParams.toString()}`;
}



    window.addEventListener('DOMContentLoaded', (event) => {
        const urlParams = new URLSearchParams(window.location.search);
        const searchInput = document.getElementById('searchInput');
        const searchQuery = urlParams.get('search');

        if (searchQuery) {
            searchInput.value = searchQuery;
        }
        searchInput.addEventListener('input', function() {
            if (this.value.trim() === '') {
                clearSearchFilter();
            }
        });
    });
    function clearSearchFilter() {
        const searchParams = new URLSearchParams(window.location.search);
        searchParams.delete('search');
        window.location.href = `/shopNew?${searchParams.toString()}`;
    }





      </script>


      <%- include('./layouts/footer') %>